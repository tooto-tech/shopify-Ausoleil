{% liquid
  assign has_applied_colour_filter = false
  assign filters_to_check = collection.filters | default: search.filters

  for filter in filters_to_check
    if filter.type == 'list' and filter.param_name contains 'color' and filter.active_values.size > 0
      assign has_applied_colour_filter = true
      break
    endif
  endfor
%}

{% capture children %}
  {% unless closest.product == blank %}
    {% render 'product-card-badges', product: closest.product, settings: settings, block_settings: block.settings %}
    {%  if settings.quick_add or settings.mobile_quick_add %}
      {% render 'quick-add', product: closest.product, section_id: section.id %}
    {% endif %}
  {% endunless %}
{% endcapture %}

{% render 'card-gallery', children: children, has_applied_colour_filter: has_applied_colour_filter %}

{% # Title and price for the zoomed out grid view %}
<div class="product-grid-view-zoom-out--details">
  {% if closest.product == blank %}
    <h3 class="h4">{{ 'content.product_card_placeholder' | t }}</h3>
  {% else %}
    <h3 class="h4">{{ closest.product.title }}</h3>
  {% endif %}
</div>

{% schema %}
{
  "name": "t:names.product_image",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "t:content.resource_reference_product_media"
    },
    {
      "type": "header",
      "content": "标签设置"
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "显示标签",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sold_out_badge",
      "label": "显示售罄标签",
      "default": true,
      "visible_if": "{{ block.settings.show_badges }}"
    },
    {
      "type": "checkbox",
      "id": "show_sale_badge",
      "label": "显示促销标签",
      "default": true,
      "visible_if": "{{ block.settings.show_badges }}"
    },
    {
      "type": "text",
      "id": "custom_badge_text",
      "label": "自定义标签文字",
      "info": "留空则不显示自定义标签",
      "visible_if": "{{ block.settings.show_badges }}"
    },
    {
      "type": "select",
      "id": "custom_badge_color_scheme",
      "label": "自定义标签颜色方案",
      "options": [
        { "value": "scheme-1", "label": "方案 1" },
        { "value": "scheme-2", "label": "方案 2" },
        { "value": "scheme-3", "label": "方案 3" },
        { "value": "scheme-4", "label": "方案 4" },
        { "value": "scheme-5", "label": "方案 5" }
      ],
      "default": "scheme-1",
      "visible_if": "{{ block.settings.show_badges and block.settings.custom_badge_text != blank }}"
    },
    {
      "type": "header",
      "content": "图片设置"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "t:options.auto"
        },
        {
          "value": "portrait",
          "label": "t:options.portrait"
        },
        {
          "value": "square",
          "label": "t:options.square"
        },
        {
          "value": "landscape",
          "label": "t:options.landscape"
        }
      ],
      "default": "portrait",
      "label": "t:settings.aspect_ratio",
      "info": "t:info.aspect_ratio_adjusted"
    },
    {
      "type": "header",
      "content": "t:content.borders"
    },
    {
      "type": "select",
      "id": "border",
      "label": "t:settings.style",
      "options": [
        {
          "value": "none",
          "label": "t:options.none"
        },
        {
          "value": "solid",
          "label": "t:options.solid"
        }
      ],
      "default": "none"
    },
    {
      "type": "range",
      "id": "border_width",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "label": "t:settings.thickness",
      "default": 1,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_opacity",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "t:settings.opacity",
      "default": 100,
      "visible_if": "{{ block.settings.border != 'none' }}"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "t:settings.left",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "t:settings.right",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "t:names.product_card_media",
      "category": "t:categories.product"
    }
  ]
}
{% endschema %}
