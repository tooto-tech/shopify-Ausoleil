{%- doc -%}
  Renders product badges for the product card.

  @param {object} product - The product object.
  @param {object} settings - The theme settings object.
  @param {object} block_settings - Block settings for badge control (optional).

  @example
  {% render 'product-card-badges', product: product, settings: settings, block_settings: block_settings %}
{%- enddoc -%}

{%- liquid
  # 默认值设置 - 检查 block_settings 是否存在
  if block_settings != blank
    assign show_badges = block_settings.show_badges
    assign show_sold_out_badge = block_settings.show_sold_out_badge
    assign show_sale_badge = block_settings.show_sale_badge
    assign custom_badge_text = block_settings.custom_badge_text
    assign custom_badge_color_scheme = block_settings.custom_badge_color_scheme | default: 'scheme-1'
  else
    assign show_badges = true
    assign show_sold_out_badge = true
    assign show_sale_badge = true
    assign custom_badge_text = ''
    assign custom_badge_color_scheme = 'scheme-1'
  endif
-%}

{%- if show_badges -%}
  <div
    class="product-badges product-badges--{{ settings.badge_position }}"
    style="
      --badge-border-radius: {{ settings.badge_corner_radius }}px;
      --badge-font-family: var(--font-{{ settings.badge_font_family }}--family); --badge-font-weight: var(--font-{{ settings.badge_font_family }}--weight); --badge-text-transform: {{ settings.badge_text_transform }};
    "
  >
    {%- liquid
      assign is_on_sale = false
      if product.compare_at_price > product.price and product.available
        assign is_on_sale = true
      endif
    -%}

    {%- comment -%} Sold Out 标签 {%- endcomment -%}
    {%- if product.available == false and show_sold_out_badge -%}
      <div class="product-badges__badge product-badges__badge--rectangle color-{{ settings.badge_sold_out_color_scheme }}">
        {{ 'content.product_badge_sold_out' | t }}
      </div>
    {%- endif -%}

    {%- comment -%} 自定义标签（有自定义标签时不显示 Sale 标签） {%- endcomment -%}
    {%- if custom_badge_text != blank and product.available -%}
      <div class="product-badges__badge product-badges__badge--rectangle color-{{ custom_badge_color_scheme }}">
        {{ custom_badge_text }}
      </div>
    {%- elsif is_on_sale and show_sale_badge -%}
      {%- comment -%} Sale 标签（仅在没有自定义标签时显示） {%- endcomment -%}
      <div class="product-badges__badge product-badges__badge--rectangle color-{{ settings.badge_sale_color_scheme }}">
        {{ 'content.product_badge_sale' | t }}
      </div>
    {%- endif -%}
  </div>
{%- endif -%}

{% stylesheet %}
  .product-badges {
    --badge-inset: max(var(--padding-xs), calc((var(--border-radius) + var(--padding-xs)) * (1 - cos(45deg))));

    position: absolute;
    z-index: var(--layer-flat);
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .product-badges--bottom-left {
    bottom: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-left {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    left: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges--top-right {
    top: calc(var(--badge-inset) + var(--padding-block-start));
    right: calc(var(--badge-inset) + var(--padding-inline-start));
  }

  .product-badges__badge {
    --badge-font-size: var(--font-size--xs);

    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: var(--color-foreground);
    background: var(--color-background);
    font-size: var(--badge-font-size);
    font-family: Mont;
    font-weight: var(--badge-font-weight);
    text-transform: var(--badge-text-transform);
    border-radius: 2px;
    line-height: 1;
    padding: 8px 12px;
  }

  .product-badges__badge--rectangle {
    padding-block: var(--badge-rectangle-padding-block);
    padding-inline: var(--badge-rectangle-padding-inline);
  }
{% endstylesheet %}
