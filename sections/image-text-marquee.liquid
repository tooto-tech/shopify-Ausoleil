{%- comment -%}
  Image Text Marquee - 图文无缝滚动走马灯
  - 均匀水平平移，无缝循环
  - 鼠标悬停暂停
{%- endcomment -%}

<div
  class="itm-section"
  style="
    background-color: {{ section.settings.bg_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
  "
>
  {%- if section.settings.title != blank -%}
    <h2 class="itm-title" style="color: {{ section.settings.title_color }};">
      {{ section.settings.title }}
    </h2>
  {%- endif -%}

  <div
    class="itm-track {% if section.settings.direction == 'reverse' %}itm-track--reverse{% endif %}"
    style="--marquee-speed: {{ section.settings.speed }}s; --marquee-gap: {{ section.settings.gap }}px;"
  >
    <div class="itm-content">
      {%- for block in section.blocks -%}
        <div class="itm-item" {{ block.shopify_attributes}}>
          <div class="itm-item__image" style="border-radius: {{ section.settings.image_radius }}px;">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 800 }}"
                alt="{{ block.settings.image.alt | default: block.settings.title | escape }}"
                loading="lazy"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
              >
            {%- else -%}
              <div class="itm-item__placeholder">{{ 'image' | placeholder_svg_tag }}</div>
            {%- endif -%}
            {%- if block.settings.link != blank -%}
              <a href="{{ block.settings.link }}" class="itm-item__link"></a>
            {%- endif -%}
          </div>
          {%- if block.settings.title != blank or block.settings.description != blank -%}
            <div class="itm-item__content" style="text-align: {{ section.settings.text_align }};">
              {%- if block.settings.title != blank -%}
                <h3 class="itm-item__title" style="color: {{ section.settings.item_title_color }};">
                  {{ block.settings.title }}
                </h3>
              {%- endif -%}
              {%- if block.settings.description != blank -%}
                <p class="itm-item__desc" style="color: {{ section.settings.desc_color }};">
                  {{ block.settings.description }}
                </p>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
    <!-- 复制一份用于无缝循环 -->
    <div class="itm-content" aria-hidden="true">
      {%- for block in section.blocks -%}
        <div class="itm-item">
          <div class="itm-item__image" style="border-radius: {{ section.settings.image_radius }}px;">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 800 }}"
                alt=""
                loading="lazy"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
              >
            {%- else -%}
              <div class="itm-item__placeholder">{{ 'image' | placeholder_svg_tag }}</div>
            {%- endif -%}
          </div>
          {%- if block.settings.title != blank or block.settings.description != blank -%}
            <div class="itm-item__content" style="text-align: {{ section.settings.text_align }};">
              {%- if block.settings.title != blank -%}
                <span class="itm-item__title" style="color: {{ section.settings.item_title_color }};">
                  {{ block.settings.title }}
                </span>
              {%- endif -%}
              {%- if block.settings.description != blank -%}
                <span class="itm-item__desc" style="color: {{ section.settings.desc_color }};">
                  {{ block.settings.description }}
                </span>
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

<style>
  .itm-section {
    width: 100%;
    overflow: hidden;
  }
  .itm-title {
    text-align: center;
    font-family: var(--font-heading--family);
    font-size: 28px;
    margin: 0 0 30px;
    padding: 0 20px;
  }
  .itm-track {
    display: flex;
    width: max-content;
    overflow: visible;
  }
  .itm-content {
    display: flex;
    gap: var(--marquee-gap);
    padding-right: var(--marquee-gap);
    animation: itm-scroll var(--marquee-speed) linear infinite;
  }
  .itm-track--reverse .itm-content {
    animation-direction: reverse;
  }
  .itm-track:hover .itm-content {
    animation-play-state: paused;
  }
  @keyframes itm-scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }
  .itm-item {
    flex-shrink: 0;
    width: calc((100vw - var(--marquee-gap) * 2) / 3 - var(--marquee-gap) * 2 / 3);
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .itm-item__image {
    position: relative;
    width: 100%;
    aspect-ratio: {{ section.settings.aspect_ratio }};
    overflow: hidden;
  }
  .itm-item__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s;
  }
  .itm-item:hover .itm-item__image img {
    transform: scale(1.05);
  }
  .itm-item__placeholder {
    width: 100%;
    height: 100%;
    background: #f0f0f0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .itm-item__placeholder svg { width: 60px; opacity: 0.3; }
  .itm-item__link {
    position: absolute;
    inset: 0;
    z-index: 2;
  }
  .itm-item__content {
    padding: 0 5px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .itm-item__title {
    font-family: var(--font-heading--family);
    font-size: 18px;
    font-weight: 600;
    margin: 0;
    line-height: 1.3;
  }
  .itm-item__desc {
    font-size: 14px;
    line-height: 1.5;
    margin: 0;
  }
  @media (max-width: 749px) {
    .itm-item {
      width: calc(100vw - 60px);
    }
    .itm-title { font-size: 22px; margin-bottom: 20px; }
    .itm-item__title { font-size: 16px; }
    .itm-item__desc { font-size: 13px; }
  }
</style>

{% schema %}
{
  "name": "图文走马灯",
  "tag": "section",
  "class": "image-text-marquee",
  "settings": [
    {
      "type": "header",
      "content": "标题设置"
    },
    {
      "type": "text",
      "id": "title",
      "label": "标题"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "标题颜色",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "布局设置"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "上内边距",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "下内边距",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "gap",
      "label": "项目间距",
      "min": 10,
      "max": 80,
      "step": 1,
      "unit": "px",
      "default": 30
    },
    {
      "type": "header",
      "content": "滚动设置"
    },
    {
      "type": "range",
      "id": "speed",
      "label": "滚动速度",
      "min": 10,
      "max": 80,
      "step": 5,
      "unit": "s",
      "default": 40,
      "info": "数值越小滚动越快"
    },
    {
      "type": "select",
      "id": "direction",
      "label": "滚动方向",
      "options": [
        { "value": "normal", "label": "向左" },
        { "value": "reverse", "label": "向右" }
      ],
      "default": "normal"
    },
    {
      "type": "header",
      "content": "图片设置"
    },
    {
      "type": "select",
      "id": "aspect_ratio",
      "label": "图片比例",
      "options": [
        { "value": "1/1", "label": "1:1 正方形" },
        { "value": "4/5", "label": "4:5 竖版" },
        { "value": "3/4", "label": "3:4 竖版" },
        { "value": "2/3", "label": "2:3 竖版" },
        { "value": "16/9", "label": "16:9 横版" },
        { "value": "4/3", "label": "4:3 横版" }
      ],
      "default": "4/5"
    },
    {
      "type": "range",
      "id": "image_radius",
      "label": "图片圆角",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "文字设置"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "文字对齐",
      "options": [
        { "value": "left", "label": "左对齐" },
        { "value": "center", "label": "居中" },
        { "value": "right", "label": "右对齐" }
      ],
      "default": "center"
    },
    {
      "type": "color",
      "id": "item_title_color",
      "label": "标题颜色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "desc_color",
      "label": "描述颜色",
      "default": "#666666"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "项目",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "图片"
        },
        {
          "type": "text",
          "id": "title",
          "label": "标题"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "描述"
        },
        {
          "type": "url",
          "id": "link",
          "label": "链接"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "图文走马灯",
      "blocks": [
        { "type": "item" },
        { "type": "item" },
        { "type": "item" },
        { "type": "item" },
        { "type": "item" },
        { "type": "item" }
      ]
    }
  ]
}
{% endschema %}
