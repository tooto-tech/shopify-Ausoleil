{%- comment -%}
  Image Text Carousel - 上方图片下方文字走马灯
{%- endcomment -%}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">


<div
  class="itc-section"
  style="
    background-color: {{ section.settings.bg_color }};
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
  "
>
  {%- if section.settings.title != blank -%}
    <h2
      class="itc-title"
      style="
        color: {{ section.settings.title_color }};
        font-size: {{ section.settings.title_size }}px;
        margin-bottom: {{ section.settings.title_margin }}px;
      "
    >
      {{ section.settings.title }}
    </h2>
  {%- endif -%}

  <div class="swiper itc-swiper" id="itc-{{ section.id }}">
    <div class="swiper-wrapper">
      {%- for block in section.blocks -%}
        <div class="swiper-slide itc-slide" {{ block.shopify_attributes }}>
          <!-- 图片区域 -->
          <div class="itc-slide__image" style="height: {{ section.settings.image_height }}px;">
            {%- if block.settings.image != blank -%}
              <img
                src="{{ block.settings.image | image_url: width: 800 }}"
                srcset="{{ block.settings.image | image_url: width: 400 }} 400w, {{ block.settings.image | image_url: width: 600 }} 600w, {{ block.settings.image | image_url: width: 800 }} 800w"
                sizes="(max-width: 749px) 90vw, {{ 100 | divided_by: section.settings.slides_desktop }}vw"
                alt="{{ block.settings.image.alt | escape }}"
                loading="lazy"
                width="{{ block.settings.image.width }}"
                height="{{ block.settings.image.height }}"
              >
            {%- else -%}
              <div class="itc-slide__placeholder">{{ 'image' | placeholder_svg_tag }}</div>
            {%- endif -%}
            {%- if block.settings.link != blank -%}
              <a
                href="{{ block.settings.link }}"
                class="itc-slide__link"
                aria-label="{{ block.settings.title | default: 'View more' }}"
              ></a>
            {%- endif -%}
          </div>

          <!-- 文字区域 -->
          <div
            class="itc-slide__content"
            style="
              text-align: {{ section.settings.text_align }};
              padding: {{ section.settings.content_padding }}px;
            "
          >
            {%- if block.settings.subtitle != blank -%}
              <span class="itc-slide__subtitle" style="color: {{ section.settings.subtitle_color }};">
                {{- block.settings.subtitle -}}
              </span>
            {%- endif -%}
            {%- if block.settings.title != blank -%}
              <h3 class="itc-slide__title" style="color: {{ section.settings.slide_title_color }};">
                {{ block.settings.title }}
              </h3>
            {%- endif -%}
            {%- if block.settings.description != blank -%}
              <p class="itc-slide__desc" style="color: {{ section.settings.desc_color }};">
                {{ block.settings.description }}
              </p>
            {%- endif -%}
            {%- if block.settings.button_text != blank -%}
              <a
                href="{{ block.settings.link | default: '#' }}"
                class="itc-slide__btn"
                style="
                  background-color: {{ section.settings.btn_bg }};
                  color: {{ section.settings.btn_color }};
                "
              >
                {{- block.settings.button_text -}}
              </a>
            {%- endif -%}
          </div>
        </div>
      {%- endfor -%}
    </div>

    {%- if section.settings.show_pagination -%}
      <div class="swiper-pagination itc-pagination"></div>
    {%- endif -%}

    {%- if section.settings.show_arrows -%}
      <div class="swiper-button-prev itc-prev"></div>
      <div class="swiper-button-next itc-next"></div>
    {%- endif -%}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
<script>
  (function() {
    function init() {
      if (typeof Swiper === 'undefined') { setTimeout(init, 100); return; }
      var el = document.getElementById('itc-{{ section.id }}');
      if (!el) return;

      new Swiper(el, {
        slidesPerView: {{ section.settings.slides_mobile }},
        spaceBetween: {{ section.settings.gap }},
        loop: {{ section.settings.loop }},
        speed: {{ section.settings.speed }},
        {% if section.settings.autoplay %}
        autoplay: { delay: {{ section.settings.autoplay_delay }}, disableOnInteraction: false },
        {% endif %}
        {% if section.settings.show_pagination %}
        pagination: { el: '.itc-pagination', clickable: true },
        {% endif %}
        {% if section.settings.show_arrows %}
        navigation: { nextEl: '.itc-next', prevEl: '.itc-prev' },
        {% endif %}
        breakpoints: {
          750: { slidesPerView: {{ section.settings.slides_desktop }}, spaceBetween: {{ section.settings.gap_desktop }} }
        }
      });
    }
    document.readyState === 'loading' ? document.addEventListener('DOMContentLoaded', init) : setTimeout(init, 100);
  })();
</script>

<style>
  .itc-section { width: 100%; overflow: hidden; }
  .itc-title { text-align: center; font-family: var(--font-heading--family); margin: 0; }
  .itc-swiper { width: 100%; padding: 0 20px; box-sizing: border-box; position: relative; }
  .itc-slide { display: flex; flex-direction: column; }
  .itc-slide__image { position: relative; width: 100%; overflow: hidden; border-radius: {{ section.settings.image_radius }}px; }
  .itc-slide__image img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s; }
  .itc-slide:hover .itc-slide__image img { transform: scale(1.05); }
  .itc-slide__placeholder { width: 100%; height: 100%; background: #f0f0f0; display: flex; align-items: center; justify-content: center; }
  .itc-slide__placeholder svg { width: 60px; opacity: 0.3; }
  .itc-slide__link { position: absolute; inset: 0; z-index: 2; }
  .itc-slide__content { display: flex; flex-direction: column; gap: 8px; }
  .itc-slide__subtitle { font-size: 12px; text-transform: uppercase; letter-spacing: 0.1em; }
  .itc-slide__title { font-size: 18px; font-weight: 600; margin: 0; font-family: var(--font-heading--family); }
  .itc-slide__desc { font-size: 14px; line-height: 1.5; margin: 0; }
  .itc-slide__btn { display: inline-block; padding: 10px 24px; font-size: 14px; text-decoration: none; border-radius: 4px; margin-top: 8px; transition: opacity 0.2s; }
  .itc-slide__btn:hover { opacity: 0.8; }
  .itc-pagination { margin-top: 20px; }
  .swiper-pagination-bullet { background: {{ section.settings.pagination_color }}; }
  .swiper-pagination-bullet-active { background: {{ section.settings.pagination_active_color }}; }
  .itc-prev, .itc-next { color: {{ section.settings.arrow_color }}; }
  @media (max-width: 749px) {
    .itc-slide__image { height: {{ section.settings.image_height_mobile }}px !important; }
    .itc-slide__title { font-size: 16px; }
    .itc-slide__desc { font-size: 13px; }
  }
</style>

{% schema %}
{
  "name": "图文走马灯",
  "tag": "section",
  "class": "image-text-carousel",
  "settings": [
    {
      "type": "header",
      "content": "标题设置"
    },
    {
      "type": "text",
      "id": "title",
      "label": "标题"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "标题大小",
      "min": 18,
      "max": 48,
      "step": 2,
      "unit": "px",
      "default": 28
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "标题颜色",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "title_margin",
      "label": "标题下边距",
      "min": 10,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "header",
      "content": "布局设置"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "背景颜色",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "上内边距",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "下内边距",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "slides_desktop",
      "label": "每行显示数量（桌面端）",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "slides_mobile",
      "label": "每行显示数量（移动端）",
      "min": 1,
      "max": 3,
      "step": 0.5,
      "default": 1.2
    },
    {
      "type": "range",
      "id": "gap_desktop",
      "label": "间距（桌面端）",
      "min": 0,
      "max": 60,
      "step": 5,
      "unit": "px",
      "default": 30
    },
    {
      "type": "range",
      "id": "gap",
      "label": "间距（移动端）",
      "min": 0,
      "max": 40,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "header",
      "content": "图片设置"
    },
    {
      "type": "range",
      "id": "image_height",
      "label": "图片高度（桌面端）",
      "min": 150,
      "max": 500,
      "step": 25,
      "unit": "px",
      "default": 300
    },
    {
      "type": "range",
      "id": "image_height_mobile",
      "label": "图片高度（移动端）",
      "min": 150,
      "max": 400,
      "step": 25,
      "unit": "px",
      "default": 250
    },
    {
      "type": "range",
      "id": "image_radius",
      "label": "图片圆角",
      "min": 0,
      "max": 30,
      "step": 2,
      "unit": "px",
      "default": 8
    },
    {
      "type": "header",
      "content": "文字设置"
    },
    {
      "type": "select",
      "id": "text_align",
      "label": "文字对齐",
      "options": [
        { "value": "left", "label": "左对齐" },
        { "value": "center", "label": "居中" },
        { "value": "right", "label": "右对齐" }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "content_padding",
      "label": "文字区域内边距",
      "min": 0,
      "max": 40,
      "step": 5,
      "unit": "px",
      "default": 15
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "副标题颜色",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "slide_title_color",
      "label": "标题颜色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "desc_color",
      "label": "描述颜色",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "按钮设置"
    },
    {
      "type": "color",
      "id": "btn_bg",
      "label": "按钮背景色",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "btn_color",
      "label": "按钮文字颜色",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "轮播设置"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "自动播放",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_delay",
      "label": "播放间隔",
      "min": 2000,
      "max": 8000,
      "step": 500,
      "unit": "ms",
      "default": 4000
    },
    {
      "type": "range",
      "id": "speed",
      "label": "切换速度",
      "min": 200,
      "max": 1000,
      "step": 100,
      "unit": "ms",
      "default": 500
    },
    {
      "type": "checkbox",
      "id": "loop",
      "label": "循环播放",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_pagination",
      "label": "显示分页点",
      "default": true
    },
    {
      "type": "color",
      "id": "pagination_color",
      "label": "分页点颜色",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "pagination_active_color",
      "label": "分页点激活颜色",
      "default": "#000000"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "显示箭头",
      "default": false
    },
    {
      "type": "color",
      "id": "arrow_color",
      "label": "箭头颜色",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "幻灯片",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "图片"
        },
        {
          "type": "text",
          "id": "subtitle",
          "label": "副标题"
        },
        {
          "type": "text",
          "id": "title",
          "label": "标题"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "描述"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "按钮文字"
        },
        {
          "type": "url",
          "id": "link",
          "label": "链接"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "图文走马灯",
      "blocks": [{ "type": "slide" }, { "type": "slide" }, { "type": "slide" }]
    }
  ]
}
{% endschema %}
